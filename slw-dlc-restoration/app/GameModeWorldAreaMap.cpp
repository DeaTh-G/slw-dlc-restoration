#include "pch.h"

static void* RETURN_ADDRESS = (void*)ASLR(0x009473FD);

__declspec(naked) void GameModeWorldAreaMapCtorMidAsmHook()
{
    __asm
    {
        lea edx, [ebp - 0x30]
        push edx
        mov ecx, esi
        call app::GameModeWorldAreaMap::CreateCircusTents
        mov ecx, esi
        jmp[RETURN_ADDRESS]
    }
}

void app::GameModeWorldAreaMap::Constructor()
{
    // Disable Screen Switch Popup
    WRITE_MEMORY(ASLR(0x00946A2D), 0x90, 0x90, 0x90, 0x90, 0x90);
    WRITE_MEMORY(ASLR(0x00946A32), 0x90, 0x90, 0x90, 0x90);
    WRITE_MEMORY(ASLR(0x00946A36), 0x90, 0x90);
    WRITE_MEMORY(ASLR(0x00946A38), 0x90, 0x90, 0x90, 0x90, 0x90, 0x90, 0x90);
    WRITE_MEMORY(ASLR(0x00946A3F), 0x90, 0x90);
    WRITE_MEMORY(ASLR(0x00946A41), 0x90, 0x90);

    // Disable -1 initialiazers
    WRITE_MEMORY(ASLR(0x009473D3), 0x90, 0x90, 0x90, 0x90, 0x90, 0x90);
    WRITE_MEMORY(ASLR(0x009473D9), 0x90, 0x90, 0x90, 0x90, 0x90, 0x90);
    WRITE_MEMORY(ASLR(0x009473DF), 0x90, 0x90, 0x90, 0x90, 0x90, 0x90);
    WRITE_MEMORY(ASLR(0x009473E5), 0x90, 0x90, 0x90, 0x90, 0x90, 0x90);
    WRITE_MEMORY(ASLR(0x009473EB), 0x90, 0x90, 0x90, 0x90, 0x90, 0x90);
    WRITE_MEMORY(ASLR(0x009473F1), 0x90, 0x90, 0x90, 0x90, 0x90, 0x90);
    WRITE_MEMORY(ASLR(0x009473F7), 0x90, 0x90, 0x90, 0x90, 0x90, 0x90);

    WRITE_JUMP(ASLR(0x009473D3), &GameModeWorldAreaMapCtorMidAsmHook);
}